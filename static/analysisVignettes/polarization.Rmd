---
title: "Polarization"
output: html_document
---

```{r}
## Pre-amble
knitr::opts_chunk$set(message = FALSE, fig.align = 'center')
library(dplyr)
library(ggplot2)
library(ggthemes)
library(directlabels) ## Great package to move labels on to figures
library(Rvoteview)
```

To explore the issue of polarization in congress over time, we will use the `Rvoteview` api to pull down some static files and directly query the database

```{r}
## Download the full member csv metadata file
members <- download_metadata('member')
## In most cases we would prefer you download the CSV from
## https://voteview.polisci.ucla.edu/data

## Load in state metadata that comes with Rvoteview
data(states)
```

Now we have a list of all members by chamber and congress. Let's append some of the state metadata so we can make some interesting plots, as well as counting the number

```{r}
head(members, 3)

member_df <- merge(members, states, all.x = T, all.y = F, by = 'state_abbrev') %>%
  group_by(party_name) %>%
  mutate(n_icpsr_party = length(unique(icpsr)))
```

Now, let's make some plots by party, state, region, and more! Let's start out by tracking the two major parties over time.

```{r}
party_df <- member_df %>%
  filter(chamber != 'President') %>%
  group_by(congress, party_name, party_code) %>%
  summarise(mean_dim1 = mean(dim1, na.rm = T),
            n_icpsr_party = mean(n_icpsr_party),
            r2_dims = cor(dim1, dim2, use = 'pairwise.complete.obs')^2)

cong_breaks <- seq(25, 115, by = 15)

ggplot(party_df[party_df$party_code %in% c(100, 200), ],
       aes(x = congress,
           y = mean_dim1,
           color = party_name)) +
  geom_line() +
  scale_y_continuous('NOMINATE First Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')')) +
  scale_color_manual('Party',
                     values = c('Democratic Party' = 'blue',
                                'Republican Party' = 'red')) +
  geom_dl(aes(label = substr(party_name, 1, 1)),
          method = list(dl.trans(x = x + 0.1),
                        "last.points",
                        cex = 0.8))  + 
  ggtitle('Major Party Ideology') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position='none')
```

Here we see the parties steadily diverging, starting in the 1950s and reaching, if not passing, the polarization of the late 19th century. Let's split out the Southern Democrats, for now simply classified as Democrats in the "South" Census Region.

```{r}
edited_party_df <- member_df %>%
  filter(chamber != 'President') %>%
  mutate(edited_party = ifelse(party_name != 'Democratic Party',
                               substr(party_name, 1, 1),
                               ifelse(census_region_name == 'South',
                                      'South D',
                                      'Other D'))) %>%
  group_by(congress, edited_party, party_code) %>%
  summarise(mean_dim1 = mean(dim1, na.rm = T))

ggplot(edited_party_df[edited_party_df$party_code %in% c(100, 200), ],
       aes(x = congress,
           y = mean_dim1,
           color = edited_party)) +
  geom_line() +
  scale_y_continuous('NOMINATE First Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')'),
                     limits = c(25, 120)) +
  scale_color_manual('Party',
                     values = c('Other D' = 'darkblue',
                                'South D' = 'lightblue',
                                'R' = 'red')) +
  geom_dl(aes(label = edited_party),
          method = list(dl.trans(x = x + 0.1,
                                 y = ifelse(label == 'Other D',
                                            y - 0.15,
                                            ifelse(label != 'R', y + 0.15, y))),
                        "last.points",
                        cex = 0.8))  + 
  ggtitle('Major Party Ideology (South v Other Dems)') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position='none')
```
  
Now let's break down the two major parties in each House.

```{r}
party_chamb_df <- member_df %>%
  filter(chamber != 'President') %>%
  group_by(congress, chamber, party_name, party_code) %>%
  summarise(mean_dim1 = mean(dim1, na.rm = T)) %>%
  mutate(party_chamber = paste(substr(party_name, 1, 1),
                               chamber))

ggplot(party_chamb_df[party_chamb_df$party_code %in% c(100, 200), ],
       aes(x = congress,
           y = mean_dim1,
           color = party_chamber,
           linetype = chamber)) +
  geom_line() +
  scale_y_continuous('NOMINATE First Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')'),
                     limits = c(25, 120)) +
  scale_color_manual('Party',
                     values = c('D House' = 'dodgerblue',
                                'D Senate' = 'darkblue',
                                'R House' = 'red',
                                'R Senate' = 'darkred')) +
  geom_dl(aes(label = party_chamber),
          method = list(dl.trans(x = x + 0.1,
                                 y = ifelse(substr(label, 1, 1) == 'D',
                                            y,
                                            ifelse(label == 'R House',
                                                   y + 0.18,
                                                   y - 0.18))),
                        "last.points",
                        cex = 0.8))  + 
  ggtitle('Major Party Ideology By Chamber') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position='none')
```

We can also get all major parties (parties who have had over 100 distinct members) throughout history:

```{r}
cong_breaks <- seq(5, 115, by = 15)
ggplot(party_df[party_df$n_icpsr_party > 100, ],
       aes(x = congress,
           y = mean_dim1,
           color = party_name)) +
  geom_line() +
  scale_y_continuous('NOMINATE First Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     limits = c(1, 115),
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')')) +
  ggtitle('All Major Party Ideology') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank())
```

What about how the two dimensions are correlated within party over time? Here we plot the percent of the variance each dimension explains of the other. You see that at the peak of the Southern Democrats control of the South, from the first World War through the Civil Rights movement, knowing the first dimension of Democratic candidates helped you explain where they were on the second dimension.

```{r}
ggplot(party_df[party_df$party_code %in% c(100, 200), ],
       aes(x = congress,
           y = r2_dims,
           color = party_name)) +
  geom_line() +
  scale_y_continuous('Correlation between NOMINATE Dim1 and Dim2',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')')) +
  scale_color_manual('Party',
                     values = c('Democratic Party' = 'blue',
                                'Republican Party' = 'red')) +
  geom_dl(aes(label = substr(party_name, 1, 1)),
          method = list(dl.trans(x = x + 0.1),
                        "last.points",
                        cex = 0.8))  +
  ggtitle('Relationship between Two Dimensions by Party') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position='none')
```

Lastly,let's see how averages have changed over time in the different census regions for both dimensions. We can see the South becoming more conservative over time, and strikingly a converge across regions along the second dimension, as racial issues no longer so clearly divide the regions.

```{r}
region_df <- member_df %>%
  filter(chamber != 'President') %>%
  group_by(congress, census_region_name) %>%
  summarise(mean_dim1 = mean(dim1, na.rm = T),
            mean_dim2 = mean(dim2, na.rm = T))

ggplot(region_df,
       aes(x = congress,
           y = mean_dim1,
           color = census_region_name)) +
  geom_line() +
  scale_y_continuous('NOMINATE First Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     limits = c(1, 120),
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')')) +
    geom_dl(aes(label = census_region_name),
          method = list(dl.trans(x = x + 0.1),
                        "last.points",
                        cex = 0.8))  + 
  ggtitle('First Dimension by Region') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position = 'none')

ggplot(region_df,
       aes(x = congress,
           y = mean_dim2,
           color = census_region_name)) +
  geom_line() +
  scale_y_continuous('NOMINATE Second (Social/Racial) Dimension\n(Liberal - Conservative)',
                     limits = c(-1, 1),
                     breaks = seq(-1, 1, by = 0.5)) +
  scale_x_continuous('Congress\n(years)',
                     breaks = cong_breaks,
                     limits = c(1, 120),
                     labels = paste0(cong_breaks,
                                     '\n(',
                                     (cong_breaks * 2) + 1787,
                                     ')')) +
  geom_dl(aes(label = census_region_name),
          method = list(dl.trans(x = x + 0.1,
                                 y = ifelse(label %in% c('South', 'West'),
                                            y + 0.1,
                                            y - 0.06)),
                        "last.points",
                        cex = 0.65))  + 
  ggtitle('Second Dimension by Region') + 
  theme_classic() + 
  theme(plot.title = element_text(hjust = 0.5), legend.position = 'none')
```
